; @package    System - CFI
; @subpackage  System.cfi
; @copyright   Copyright (C) Sergey Tolkachyov. All rights reserved.
; @license     GNU General Public License version 3 or later; see http://www.gnu.org/licenses/gpl-3.0.txt

PLG_CFI="Система - CFI"
PLG_CFI_DESC="Плагин импорта и экспорта материалов с пользовательскими полями"

PLG_CFI_DESC_FULL_LABEL="Время выполнения и объёмы материалов"
PLG_CFI_DESC_FULL_DESC="<p>PHP-скрипту устанавливается лимит <code>0</code>. Далее на временные лимиты влияют параметры самого веб-сервера: Nginx (<code>fastcgi_read_timeout</code>, <code>proxy_read_timeout</code>, <code>client_body_timeout</code>), Apache (<code>Timeout</code>, <code>ProxyTimeout</code>), PHP-FPM (<code>request_terminate_timeout</code>), из-за чего скрипт может прекратить свою работу по инициативе веб-сервера.</p><p>Экспорт выполняется быстрее, чем импорт. Скорость импорта на слабом сервере может колебаться от 3-4 до 10 материалов в секунду. Объём экспорта на слабом сервере может составлять до нескольких десятков тысяч материалов с учётом пользовательских полей. На тестах 14000 материалов  без пользовательских полей выгружалось чуть меньше 1,5 минут.</p><p>Большое влияние имеет количество импортируемых свойств материала, есть ли среди них нередактируемые свойства (<code>hits</code>, <code>modified</code> и т.д.), а так же количество пользовательских полей. Чем больше пользовательских полей, тем медленнее происходит импорт. Рекомендуется подобрать оптимальное количество импортируемых данных опытным путём, большое количество материалов импортировать по частям, так как длительные тяжёлые процессы обычно выполняются в CLI-интерфейсе.</p>"
PLG_CFI_DESC_FULL_EXPORT_LABEL="Как проходит экспорт?"
PLG_CFI_DESC_FULL_EXPORT="<p>При экспорте вы можете выгрузить до нескольких десятков тысяч материалов.</p> <h4>Фильтрация материалов</h4> <p>При экспорте учитываются фильтры материалов панели администратора Joomla (параметры поиска). Вы можете выгрузить материалы только одной или нескольких выбранных категорий, только избранные, только опубликованные, только с определёнными тегами и так далее. Параметр <code>количество элементов на странице</code> влияет на количество материалов в \"пачке\",выгружаемых из базы данных за раз.</p> <h4>Свойства материала для экспорта</h4> <p>В окне экспорта вы можете выбрать какие именно свойства материала (<code>title</code>, <code>catid</code> и т.д.) выгружать. Всем свойствам материала добавляется префикс <code>article</code>: <code>id</code> => <code>articleid</code>. Свойства материала используются в качестве заголовков таблицы. Свойство материала <code>id</code> выгружается всегда. Дополнительно к свойствам материала можно выгрузить id тегов.</p><h4>Пользовательские поля материала</h4><p>При экспорте можно выбрать какие именно пользовательские поля выгружать или не выгружать их вообще. В качестве заголовков таблицы используются системные имена пользовательских полей.</p><p>Пользовательские поля материалов могут принадлежать разным категориям. Убедитесь, что все выбранные категории имеют одинаковый набор полей.</p><p>Если часть пользовательских полей принадлежат всем категориям, а часть - только одной категории, то экспорт объединит эти поля в одну таблицу.<p><p>Если в выгрузке окажутся материалы из разных категорий, поля которых принадлежат только этим категориям, то экспорт <strong>попытается</strong> объединить их в одну таблицу. Однако, корректность экспорта в таком случае не гарантируется.</p><h4>Пример</h4><p>Вы можете выбрать только <code>id</code> материала и нужные вам пользовательские поля. Импорт затем корректно обработает такую таблицу.</p>"
PLG_CFI_DESC_FULL_IMPORT_LABEL="Как происходит импорт?"
PLG_CFI_DESC_FULL_IMPORT="<p>С помощью импорта вы можете создавать новые материалы или обновлять существующие. Столбец <code>articleid</code> в таблице импорта используется как идентификатор материала.</p><p>Если в таблице импорта в столбце <code>articleid</code> пустота или <code>0</code>, то импорт создаст новый материал. Если есть, то обновит материал с указанным значением <code>articleid</code>.</p><h4>Создание новых материалов</h4><p>Если для новых материалов не указана категория (отсутствует столбец <code>catid</code> или он пустой), то импорт создаст материал в категории по умолчанию (первая категория в списке). Для нового материала обязательно поле <code>articletitle</code> (заголовок материала).</p><h4>Обновление материалов</h4><p>Для обновления материалов обязательно поле <code>articleid</code>. В остальных столбцах можно указывывать любые свойства материала, которые вы можете увидеть в форме создания материала, включая даже нередактируемые (<code>hits</code> - количество просмотров, <code>modified</code> - дата последнего изменения и т.д.).</p><p>Также с помощью импорта можно обновлять <strong>только</strong> пользовательские поля материала. Для этого в таблице импорта обязательно должен быть столбец <code>articleid</code>, а остальные заголовки столбцов должны соответствовать системным именам пользовательских полей. Также формат данных должен быть таким же, какой предусматривают эти поля: в некоторых случаях это обычные строки, а в некоторых - массивы или <code>json</code>.</p>"
PLG_CFI_DESC_FULL_FOR_DEVELOPERS_LABEL="Разработчикам"
PLG_CFI_DESC_FULL_FOR_DEVELOPERS="<p>При импорте и экспорте вы можете обрабатывать данные с помощью собственных плагинов. Создайте плагин группы <code>cfi</code>. Вызов плагина происходит в изолированном диспетчере, поэтому все остальные плагины не будут вызваны, даже системные.</p><h4>Импорт</h4><p>Добавьте в плагин событие <code>onImportPrepareArticleData($event)</code>. Событие вызывается при импорте для каждой строчки импортируемой таблицы. Вы можете получить данные <code>$colummns = $event->getArgument('columns');</code>, <code>$strNum = $event->getArgument('strNum');</code>, <code>$article = $event->getArgument('article');</code>. Вернуть обработанные данные обратно в процесс импорта: <code>$event->setArgument('article', $article);</code>. Необходимо, чтобы количество столбцов в массиве <code>$columns</code> совпадало с количеством столбцов в массиве <code>$article</code>. Иначе будет ошибка. В <code>$strNum</code> хранится номер строки в таблице импорта.</p><h4>Экспорт</h4><p>Добавьте в плагин событие <code>onExportPrepareData($event)</code>. Экспорт получает список материалов из модели с <code>list.limit</code> согласно настройкам. Событие вызывается при экспорте для каждой страницы пагинации списка материалов. Вы можете получить данные: <code>$colummns = $event->getArgument('columns');</code> - выгружаемые данные, заголовки таблицы. <code>$articles = $event->getArgument('articles');</code> - массив с полными данными материалов. Вернуть обработанные данные обратно в процесс экспорта: <code>$event->setArgument('articles', $articles);</code>. В <code>$articles</code> хранится массив с данными материалов. Вернуть обработанные данные обратно в процесс импорта: <code>$event->setArgument('articles', $articles);</code>.</p>"

PLG_CFI_PARAM_CP="Кодовая страница для конвертации файлов"
PLG_CFI_PARAM_SHOWDESC="Показывать описание о формате импортируемого файла"
PLG_CFI_BUTTON="Импорт / экспорт в CSV"
PLG_CFI_BUTTON_TITLE="Импорт и экспорт данных данных из CSV и в CSV"
PLG_CFI_CB_UTF_CONVERT="Преобразовывать кодировку UTF-8 <=> %s (кодировка выбирается в параметрах плагина, применяется для табличных редакторов)"
; Export
PLG_CFI_EXPORT = "Экспорт"
PLG_CFI_EXPORT_PARAMS_LABEL="Параметры экспорта"
PLG_CFI_EXPORT_PARAMS_USE_TAGS = "Выгружаем теги"
PLG_CFI_EXPORT_PARAMS_USE_CUSTOM_FIELDS = "Выгружаем поля"
PLG_CFI_EXPORT_PARAMS_ARTICLE_PROPS_LIST = "Данные материала"
PLG_CFI_EXPORT_PARAMS_ARTICLE_PROPS_LIST_DESC="Выберите какие свойства материала Joomla будут выделены по умолчанию при экспорте. Свойство <code>id</code> (<code>articleid</code>) выгружается всегда"
PLG_CFI_EXPORT_DOWNLOAD_BTN = "Скачать"
PLG_CFI_EXPORT_FILTER_LABEL="Применённые фильтры"
PLG_CFI_EXPORT_ARTICLE_PROPS_LABEL="Свойства материала"
PLG_CFI_EXPORT_ARTICLE_FIELDS_LABEL="Пользовательские поля"
PLG_CFI_EXPORT_SUCCESS="Экспорт завершён"
PLG_CFI_EXPORT_ERROR="Ошибка экспорта данных"

PLG_CFI_EXPORT_CUSTOM_FIELDS_DISCLAIMER="Пользовательские поля материалов могут принадлежать разным категориям. Убедитесь, что все выбранные категории имеют одинаковый набор полей. Иначе при экспорте возможны ошибки структуры данных."
PLG_CFI_EXPORT_FILE_CREATE="Ошибка создания результирующего файла: нет доступа для записи файла"
PLG_CFI_EXPORT_ERROR_CONVERT="Ошибка перекодирования файла в указанную кодировку"
PLG_CFI_EXPORT_ERROR_AFTER_CONVERT="Ошибка записи файла после перекодирования"
PLG_CFI_EXPORT_ERROR_BEFORE_CONVERT="Ошибка чтения файла для перекодирования"

; Import
PLG_CFI_IMPORT = "Импорт"
PLG_CFI_IMPORT_UPLOAD_DRAG_FILE_HERE="Перетащите в поле файл для загрузки"

PLG_CFI_IMPORT_UPLOAD_ERROR_UPLOAD_NO_FILE = "Не указан файл"
PLG_CFI_IMPORT_UPLOAD_ERROR_UPLOAD_FILE_TOO_BIG = "Выбранный файл слишком большой"
PLG_CFI_IMPORT_UPLOAD_ERROR_UPLOAD_WRONG_MIME_TYPE = "Неверный MIME-тип файла"
PLG_CFI_IMPORT_UPLOAD_ERROR_UPLOAD_UNKNOWN = "Неизвестная ошибка или некорректный вывод JSON."
PLG_CFI_IMPORT_UPLOAD_ERROR_UPLOAD_EMPTY = "Ошибка: Сервер вернул пустой ответ."
PLG_CFI_IMPORT_UPLOAD_FILE_OK = "Файл успешно загружен"
PLG_CFI_IMPORT_UPLOAD_SELECT_FILE = "Или выберите файл"

PLG_CFI_IMPORT_UPLOAD_WARN_SERVER_DENY_FILE_UPLOAD = "На сервере запрещена загрузка файлов"
PLG_CFI_IMPORT_UPLOAD_WARN_NO_FILE_SELECTED = "Ошибка получения файла из временного окружения сервера"
PLG_CFI_IMPORT_UPLOAD_WARN_UPLOADERROR = "Не удалось загрузить файл на сервер."
PLG_CFI_IMPORT_UPLOAD_FAIL="Ошибка перемещения файла во временный каталог для дальнейшей обработки"

PLG_CFI_IMPORT_UPLOADED_FILE_INFO_FILENAME ="Файл"
PLG_CFI_IMPORT_UPLOADED_FILE_INFO_LINES ="Количество строк"

PLG_CFI_IMPORT_GETCSVMETADATA_ERROR_OPEN_FILE="Не удалось открыть файл: %s"
PLG_CFI_IMPORT_GETCSVMETADATA_ERROR_READ_CSV_HEADERS="Не удалось прочитать заголовки из файла: %s"

PLG_CFI_IMPORT_GET_CATEGORIES="Ошибка получения списка категорий материалов"
PLG_CFI_IMPORT_EMPTY="Файл не содержит данных для импорта или не содержит строку заголовков полей"
PLG_CFI_IMPORT_NO_COLUMN="Отсутствует обязательное поле articleid"
PLG_CFI_IMPORT_COLUMN_EXCEPT="Кол-во значений в строке не соответствует кол-ву объявленных колонок"
PLG_CFI_IMPORT_LOAD_ARTICLE="Ошибка загрузки материала с id %s"
PLG_CFI_IMPORT_SAVE_ARTICLE="Ошибка сохранения материала"
PLG_CFI_IMPORT_SAVENEW_ARTICLE="Материал сохранён как новый"
PLG_CFI_IMPORT_SAVE_FIELDS="Ошибка сохранения значений полей: %s"

PLG_CFI_IMPORT_CFI_IMPORT_PROGRESS_DATA_CONTINUES="Пропущено"
PLG_CFI_IMPORT_CFI_IMPORT_PROGRESS_DATA_ERRORS="Ошибок"
PLG_CFI_IMPORT_CFI_IMPORT_PROGRESS_DATA_INSERTS="Новых"
PLG_CFI_IMPORT_CFI_IMPORT_PROGRESS_DATA_UPDATES="Обновлено"
PLG_CFI_IMPORT_CFI_IMPORT_PROGRESS_DATA_ERROR_LIST="Список ошибок"
PLG_CFI_IMPORT_SUCCESS="Импорт завершён"
PLG_CFI_IMPORT_ERROR="Ошибка импорта данных"

PLG_CFI_PROCESS_CANCELED_BY_USER = "Процесс отменён пользователем"